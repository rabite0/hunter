dist: xenial
language: rust
rust: nightly
cache: cargo

branches:
  only:
    - /^v\d+\.\d+\.\d+.*$/
    - master

matrix:
  include:
    # Linux
    - env: TARGET=armv7-unknown-linux-gnueabihf ARCH=linux-arm-32
    - env: TARGET=aarch64-unknown-linux-gnu ARCH=linux-arm-64
    - env: TARGET=i686-unknown-linux-gnu ARCH=linux-intel-32
    - env: TARGET=x86_64-unknown-linux-gnu ARCH=linux-intel-64

    # OSX
    - env: TARGET=i686-apple-darwin ARCH=macos-intel-32
      os: osx
    - env: TARGET=x86_64-apple-darwin ARCH=macos-intel-64
      os: osx

    # *BSD
    - env: TARGET=i686-unknown-freebsd ARCH=bsd-intel-32
    - env: TARGET=x86_64-unknown-freebsd ARCH=bsd-intel-64

install:
  - command -v cross || cargo install cross

script:
  - cross build --target $TARGET --release

before_deploy:
  - name="hunter-$TRAVIS_BRANCH-$ARCH"
  - mkdir $name
  - cp target/$TARGET/release/hunter $name/
  - cp README.md LICENSE $name/
  - GZIP=-9 tar czvf $name.tar.gz $name/*

deploy:
  provider: releases
  api_key:
    secure: RLM3/17wltH4FQpW3tqlOtt30hBiJRjRgmCIKcJr364Yc2J4CtnSVHmqZWyJSDrQrwOyIrHBjY+kpcxQlWa/R+ODAiYbaQ5PTNdefV+uYDUrQAtNnWPtFUhWJJJC32hQM9PZh250tJ8qZNSK8BAuHREUQg/yKpkPLWimRluV0nMn2MAVFIPjbZEYymWW9bxurBb+vwO3fxlLZo1GhnPqLd5yGwPf06ZpC+5/sald7M3beYQa8f1kF+grZGB1NWnJpbTMKJnZQkS3fJ1lkNV+xWh16CJOAu9zNIW0xS8lJhEv/wgefe/G5frlFp4LEsSnySeZOyO3BfuV1NLd0Y1Ltqx8F0u1lJhV7EyJFG1mw3QFoCaCpik+dVuec0xgit8Wl1Uitl9ynEvxbDytxOq/aVdCRgSr5l/KDj2OJx4y+CjT+PhebDgUzkoX/7jiW0HKnAp+BdbVL0kYby9VeBNBS0qPyf/VhyT+r9kb6crBWRN/Cpij3nygXC96U8IbC7VwQh0cZsH7ptcCfOKflN5g38pJY3HjXuzhRiuFWm6LlFPGThZ2gqUmeSg5z2ZIDrIxLYHrhU2oskfej4Z1g+6/qVSuUuJvCq5C8uEA0UoME+4JQZSDRGi4QmcjPQLOJC7nGsqQ+CG7glaQlihZqN6x/3eLUMWOVF66w+AFNyysvSk=
  file: hunter-$TRAVIS_BRANCH-$ARCH.tar.gz
  skip_cleanup: yes
  draft: yes
  on:
    tags: yes

notifications:
  email:
    on_success: never
